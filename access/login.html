<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zugang – Verlassenschaftsverfahren.at</title>
    <style>
        body {
            margin: 0;
            min-height: 100vh;
            display: grid;
            place-items: center;
            font-family: Arial, sans-serif;
            background: #f3f5f8;
            color: #1f2937;
        }
        .card {
            width: min(92vw, 380px);
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 8px 24px rgba(15, 23, 42, 0.08);
        }
        h1 {
            margin: 0 0 8px;
            font-size: 1.3rem;
        }
        p {
            margin: 0 0 16px;
            font-size: 0.95rem;
            line-height: 1.45;
        }
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
        }
        input {
            width: 100%;
            box-sizing: border-box;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 1rem;
            margin-bottom: 12px;
        }
        button {
            width: 100%;
            border: 0;
            border-radius: 8px;
            padding: 11px 12px;
            background: #5A84D8;
            color: #fff;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
        }
        .error {
            min-height: 20px;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #b91c1c;
        }
    </style>
</head>
<body>
    <main class="card">
        <h1>Geschützter Bereich</h1>
        <p>Bitte Passwort eingeben, um die Seite anzuzeigen.</p>
        <form id="access-form">
            <label for="access-password">Passwort</label>
            <input id="access-password" name="password" type="password" autocomplete="current-password" required>
            <button type="submit">Anmelden</button>
            <div class="error" id="access-error" aria-live="polite"></div>
        </form>
    </main>

    <script>
        (function () {
            var ACCESS_PASSWORD = "ferien1234";
            var ACCESS_KEY = "site_access_granted";
            var form = document.getElementById("access-form");
            var input = document.getElementById("access-password");
            var error = document.getElementById("access-error");

            function getSafeNext() {
                var params = new URLSearchParams(window.location.search);
                var next = params.get("next");
                var fallback = "../index.html";

                if (!next) {
                    return fallback;
                }

                try {
                    var decoded = decodeURIComponent(next);
                    if (!decoded.startsWith("/")) {
                        return fallback;
                    }
                    if (decoded.indexOf("/access/login") !== -1) {
                        return fallback;
                    }
                    return decoded;
                } catch (e) {
                    return fallback;
                }
            }

            form.addEventListener("submit", function (event) {
                event.preventDefault();
                if (input.value !== ACCESS_PASSWORD) {
                    error.textContent = "Passwort ist falsch.";
                    input.focus();
                    input.select();
                    return;
                }

                sessionStorage.setItem(ACCESS_KEY, "1");
                window.location.replace(getSafeNext());
            });
        })();
    </script>
</body>
</html>
